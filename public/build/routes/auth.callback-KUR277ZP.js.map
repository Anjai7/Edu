{
  "version": 3,
  "sources": ["../../../app/routes/auth.callback.tsx"],
  "sourcesContent": ["// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app\\\\\\\\routes\\\\\\\\auth.callback.tsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app\\\\routes\\\\auth.callback.tsx\");\n  import.meta.hot.lastModified = \"1757752669262.416\";\n}\n// REMIX HMR END\n\nimport { useEffect } from \"react\";\nimport { supabase, checkUserRole } from \"~/utils/supabase\";\nexport default function AuthCallback() {\n  _s();\n  useEffect(() => {\n    const handleAuthCallback = async () => {\n      try {\n        console.log('=== AUTH CALLBACK STARTED ===');\n        console.log('Current URL:', window.location.href);\n        console.log('Hash:', window.location.hash);\n        console.log('Search:', window.location.search);\n\n        // Supabase automatically handles the OAuth callback, just get the session\n        const {\n          data,\n          error\n        } = await supabase.auth.getSession();\n        console.log('Session data:', data);\n        console.log('Session error:', error);\n        if (error) {\n          console.error('Auth session error:', error);\n          window.location.href = '/login?error=auth_failed';\n          return;\n        }\n        if (data.session?.user) {\n          const user = data.session.user;\n          const userEmail = user.email;\n          console.log('User found:', {\n            email: userEmail,\n            user\n          });\n          if (!userEmail) {\n            console.error('No email found in session');\n            window.location.href = '/login?error=no_email';\n            return;\n          }\n\n          // Check if user email is allowed and get their role\n          console.log('Checking user role for:', userEmail);\n          const roleCheck = await checkUserRole(userEmail);\n          console.log('Role check result:', roleCheck);\n          if (!roleCheck.isAllowed) {\n            console.error('Email not allowed:', roleCheck.error);\n            await supabase.auth.signOut();\n            window.location.href = '/login?error=not_allowed';\n            return;\n          }\n          console.log('User role verified:', roleCheck.role);\n\n          // Store authentication info with verified role\n          sessionStorage.setItem('isAuthenticated', 'true');\n          sessionStorage.setItem('userEmail', userEmail);\n          sessionStorage.setItem('userType', roleCheck.role || 'student');\n          sessionStorage.setItem('userName', user.user_metadata?.full_name || userEmail.split('@')[0] || 'User');\n          console.log('Session storage set successfully');\n\n          // Redirect based on role\n          const redirectPath = roleCheck.role === 'staff' ? '/admin/dashboard' : '/student/dashboard';\n          console.log('Redirecting to:', redirectPath);\n\n          // Use a longer delay and force reload to ensure proper redirect\n          setTimeout(() => {\n            console.log('Executing redirect now...');\n            window.location.replace(redirectPath);\n          }, 500);\n          return;\n        } else {\n          console.log('No session found, redirecting to login');\n          window.location.href = '/login';\n        }\n      } catch (err) {\n        console.error('Unexpected error during auth callback:', err);\n        window.location.href = '/login?error=unexpected_error';\n      }\n    };\n\n    // Add a small delay to ensure the page is fully loaded\n    setTimeout(() => {\n      handleAuthCallback();\n    }, 100);\n  }, []);\n  return <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center\">\r\n      <div className=\"text-center\">\r\n        <div className=\"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\r\n        <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">Signing you in...</h2>\r\n        <p className=\"text-gray-600\">Please wait while we complete your Gmail authentication.</p>\r\n      </div>\r\n    </div>;\n}\n_s(AuthCallback, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n_c = AuthCallback;\nvar _c;\n$RefreshReg$(_c, \"AuthCallback\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;"],
  "mappings": "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",
  "names": []
}
